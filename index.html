<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insparisk Agent Scheduler</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .agent-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .agent-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .agent-card:hover {
            border-color: #4f46e5;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(79, 70, 229, 0.1);
        }

        .agent-card.selected {
            border-color: #4f46e5;
            background: linear-gradient(135deg, #eef2ff 0%, #f0f4ff 100%);
        }

        .agent-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .agent-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 10px;
        }

        .agent-description {
            color: #64748b;
            line-height: 1.6;
        }

        .scheduling-section {
            background: #f8fafc;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .recurring-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .recurring-option {
            padding: 12px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .recurring-option:hover {
            border-color: #4f46e5;
            background: #f0f4ff;
        }

        .recurring-option.selected {
            border-color: #4f46e5;
            background: #4f46e5;
            color: white;
        }

        .day-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .day-option {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 14px;
        }

        .day-option:hover {
            border-color: #4f46e5;
            background: #f0f4ff;
        }

        .day-option.selected {
            border-color: #4f46e5;
            background: #4f46e5;
            color: white;
        }

        .day-option.weekend {
            background: #fef3c7;
            border-color: #f59e0b;
        }

        .day-option.weekend.selected {
            background: #f59e0b;
            color: white;
        }

        .business-days-info {
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .business-days-info h4 {
            color: #065f46;
            margin-bottom: 8px;
        }

        .business-days-info p {
            color: #047857;
            font-size: 14px;
        }

        .btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3);
        }

        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .schedules-list {
            background: white;
            border-radius: 16px;
            padding: 30px;
        }

        .schedule-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .schedule-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        .delete-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .schedule-info h4 {
            color: #1e293b;
            margin-bottom: 5px;
        }

        .schedule-info p {
            color: #64748b;
            font-size: 14px;
        }

        .schedule-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }

        .status-failed {
            background: #fee2e2;
            color: #991b1b;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-message {
            background: #d1fae5;
            border: 1px solid #a7f3d0;
            color: #065f46;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error-message {
            background: #fee2e2;
            border: 1px solid #fca5a5;
            color: #991b1b;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .agent-cards {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .main-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Agent Scheduler</h1>
            <p>Schedule your Insparisk agents with smart business day detection</p>
        </div>

        <div class="main-content">
            <div class="success-message" id="successMessage"></div>
            <div class="error-message" id="errorMessage"></div>

            <!-- Agent Selection -->
            <div class="scheduling-section">
                <h2 class="section-title">Select Agent</h2>
                <div class="agent-cards">
                    <div class="agent-card" data-agent="accounts_receivable" data-webhook="https://insparisk.app.n8n.cloud/webhook/start-flow">
                        <div class="agent-icon">üí∞</div>
                        <h3 class="agent-title">Accounts Receivable</h3>
                        <p class="agent-description">Automated accounts receivable management and follow-up system</p>
                    </div>
                    <div class="agent-card" data-agent="boiler_quote" data-webhook="https://insparisk.app.n8n.cloud/webhook/boiler">
                        <div class="agent-icon">üî•</div>
                        <h3 class="agent-title">Boiler Quote</h3>
                        <p class="agent-description">Intelligent boiler quote generation and customer communication</p>
                    </div>
                </div>
            </div>

            <!-- Scheduling Form -->
            <div class="scheduling-section">
                <h2 class="section-title">Schedule Settings</h2>
                <form id="schedulingForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="userPassword">Access Password</label>
                            <input type="password" id="userPassword" class="form-input" required placeholder="Enter access password">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="scheduleDate">Schedule Date</label>
                            <input type="date" id="scheduleDate" class="form-input" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="scheduleTime">Schedule Time</label>
                            <input type="time" id="scheduleTime" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="timezone">Timezone</label>
                            <select id="timezone" class="form-select" required>
                                <option value="America/New_York">Eastern Time (ET)</option>
                                <option value="America/Chicago">Central Time (CT)</option>
                                <option value="America/Denver">Mountain Time (MT)</option>
                                <option value="America/Los_Angeles">Pacific Time (PT)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Recurring Schedule</label>
                        <div class="recurring-options">
                            <div class="recurring-option" data-pattern="none">One Time</div>
                            <div class="recurring-option" data-pattern="daily">Daily</div>
                            <div class="recurring-option" data-pattern="weekly">Weekly</div>
                            <div class="recurring-option" data-pattern="monthly">Monthly</div>
                        </div>
                    </div>

                    <div class="form-group" id="daySelection" style="display: none;">
                        <label class="form-label">Select Days of the Week</label>
                        <div class="day-options">
                            <div class="day-option" data-day="monday">Monday</div>
                            <div class="day-option" data-day="tuesday">Tuesday</div>
                            <div class="day-option" data-day="wednesday">Wednesday</div>
                            <div class="day-option" data-day="thursday">Thursday</div>
                            <div class="day-option" data-day="friday">Friday</div>
                            <div class="day-option" data-day="saturday">Saturday</div>
                            <div class="day-option" data-day="sunday">Sunday</div>
                        </div>
                    </div>

                    <div class="business-days-info">
                        <h4>üîê Access Control</h4>
                        <p>Only authorized users with the correct password can create schedules. For weekly schedules, you can select specific days. The system will automatically skip US federal holidays, but you can choose to include weekends if needed.</p>
                    </div>

                    <button type="submit" class="btn" id="scheduleBtn">
                        Schedule Agent
                    </button>
                </form>
            </div>

            <!-- Loading State -->
            <div class="loading" id="loadingState">
                <div class="spinner"></div>
                <p>Creating your schedule...</p>
            </div>

            <!-- Existing Schedules -->
            <div class="schedules-list">
                <h2 class="section-title">Your Scheduled Agents</h2>
                <div id="schedulesList">
                    <!-- Schedules will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://vxhmqlavlukdsfcqnllu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ4aG1xbGF2bHVrZHNmY3FubGx1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxMTY5NTQsImV4cCI6MjA2NDY5Mjk1NH0.qT-r7diyeLkSWsE5AgyYQjHg0OFTVK5gu0Cv3Ny37LI';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Global variables
        let selectedAgent = null;
        let selectedRecurring = 'none';
        let selectedDays = [];

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadExistingSchedules();
        });

        function initializeApp() {
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('scheduleDate').value = today;
            
            // Set default time to 9:00 AM
            document.getElementById('scheduleTime').value = '09:00';
        }

        function setupEventListeners() {
            // Agent selection
            document.querySelectorAll('.agent-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.agent-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedAgent = {
                        type: this.dataset.agent,
                        webhook: this.dataset.webhook
                    };
                });
            });

            // Recurring options
            document.querySelectorAll('.recurring-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.recurring-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedRecurring = this.dataset.pattern;
                    
                    // Show/hide day selection based on pattern
                    const daySelection = document.getElementById('daySelection');
                    if (selectedRecurring === 'weekly') {
                        daySelection.style.display = 'block';
                    } else {
                        daySelection.style.display = 'none';
                        selectedDays = [];
                        document.querySelectorAll('.day-option').forEach(d => d.classList.remove('selected'));
                    }
                });
            });

            // Day selection
            document.querySelectorAll('.day-option').forEach(option => {
                const day = option.dataset.day;
                
                // Add weekend styling
                if (day === 'saturday' || day === 'sunday') {
                    option.classList.add('weekend');
                }
                
                option.addEventListener('click', function() {
                    if (this.classList.contains('selected')) {
                        this.classList.remove('selected');
                        selectedDays = selectedDays.filter(d => d !== day);
                    } else {
                        this.classList.add('selected');
                        selectedDays.push(day);
                    }
                });
            });

            // Form submission
            document.getElementById('schedulingForm').addEventListener('submit', handleFormSubmit);
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            
            if (!selectedAgent) {
                showError('Please select an agent first');
                return;
            }

            // Check password authentication
            const password = document.getElementById('userPassword').value;
            if (password !== 'insparisk#1') {
                showError('Invalid access password. Please contact administrator.');
                return;
            }

            const formData = {
                userPassword: password,
                scheduleDate: document.getElementById('scheduleDate').value,
                scheduleTime: document.getElementById('scheduleTime').value,
                timezone: document.getElementById('timezone').value,
                agentType: selectedAgent.type,
                webhookUrl: selectedAgent.webhook,
                isRecurring: selectedRecurring !== 'none',
                recurringPattern: selectedRecurring === 'none' ? null : selectedRecurring,
                selectedDays: selectedDays
            };

            try {
                showLoading(true);
                
                // Create schedule in database with proper timezone conversion
                const scheduleDateTime = `${formData.scheduleDate}T${formData.scheduleTime}:00`;
                const userTimezone = formData.timezone || 'America/New_York';
                
                // Parse the date/time as if it's in the user's selected timezone
                // We need to convert the user's local time to UTC properly
                let utcTime;
                
                // Create a date string that will be interpreted correctly
                // Format: YYYY-MM-DDTHH:mm:ss
                const [datePart, timePart] = scheduleDateTime.split('T');
                const [year, month, day] = datePart.split('-').map(Number);
                const [hour, minute] = timePart.split(':').map(Number);
                
                // Create a date in UTC with the user's intended time
                // Then we'll adjust based on their timezone offset
                const tempDate = new Date(Date.UTC(year, month - 1, day, hour, minute, 0));
                
                // Get the timezone offset for the selected timezone
                // For America/New_York (Eastern Time): UTC-5 (EST) or UTC-4 (EDT)
                // We need to ADD the offset to convert local time to UTC
                let timezoneOffsetHours = 0;
                if (userTimezone === 'America/New_York') {
                    // Eastern Time is UTC-5 (EST) or UTC-4 (EDT)
                    // In October 2025, it's EDT (UTC-4), so we add 4 hours
                    timezoneOffsetHours = 4; // EDT offset
                } else if (userTimezone === 'America/Chicago') {
                    timezoneOffsetHours = 5; // CDT offset
                } else if (userTimezone === 'America/Denver') {
                    timezoneOffsetHours = 6; // MDT offset
                } else if (userTimezone === 'America/Los_Angeles') {
                    timezoneOffsetHours = 7; // PDT offset
                }
                
                // Add the timezone offset to convert to UTC
                const utcDate = new Date(tempDate.getTime() + (timezoneOffsetHours * 60 * 60 * 1000));
                utcTime = utcDate.toISOString();

                // Calculate next trigger time on the client side to avoid database trigger timeout
                let nextTriggerTime = utcTime;
                
                // If recurring with selected days, find the next occurrence
                if (formData.isRecurring && formData.selectedDays.length > 0) {
                    const dayMap = {
                        'sunday': 0, 'monday': 1, 'tuesday': 2, 'wednesday': 3,
                        'thursday': 4, 'friday': 5, 'saturday': 6
                    };
                    
                    const nowUTC = new Date(); // Current time in UTC
                    const scheduleDate = new Date(utcTime);
                    const targetHour = scheduleDate.getUTCHours();
                    const targetMinute = scheduleDate.getUTCMinutes();
                    
                    // Convert selected days to day numbers
                    const targetDays = formData.selectedDays.map(day => dayMap[day.toLowerCase()]).sort((a, b) => a - b);
                    
                    // Find the next occurrence
                    let found = false;
                    
                    // Check up to 14 days ahead to ensure we find a match
                    for (let i = 0; i <= 14; i++) {
                        const checkDate = new Date(nowUTC);
                        checkDate.setUTCDate(nowUTC.getUTCDate() + i);
                        checkDate.setUTCHours(targetHour);
                        checkDate.setUTCMinutes(targetMinute);
                        checkDate.setUTCSeconds(0);
                        checkDate.setUTCMilliseconds(0);
                        
                        const dayOfWeek = checkDate.getUTCDay();
                        
                        // Check if this day matches our target days AND is in the future
                        if (targetDays.includes(dayOfWeek) && checkDate > nowUTC) {
                            nextTriggerTime = checkDate.toISOString();
                            found = true;
                            break;
                        }
                    }
                    
                    if (!found) {
                        // Fallback: use the original schedule time
                        nextTriggerTime = utcTime;
                    }
                } else if (formData.isRecurring) {
                    // For daily/weekly without specific days, use the schedule time if it's in the future
                    const scheduleDate = new Date(utcTime);
                    const now = new Date();
                    
                    if (scheduleDate <= now) {
                        // If schedule time is in the past, calculate next occurrence
                        if (formData.recurringPattern === 'daily') {
                            const tomorrow = new Date(now);
                            tomorrow.setUTCDate(tomorrow.getUTCDate() + 1);
                            tomorrow.setUTCHours(scheduleDate.getUTCHours());
                            tomorrow.setUTCMinutes(scheduleDate.getUTCMinutes());
                            tomorrow.setUTCSeconds(0);
                            nextTriggerTime = tomorrow.toISOString();
                        } else if (formData.recurringPattern === 'weekly') {
                            const nextWeek = new Date(scheduleDate);
                            nextWeek.setUTCDate(nextWeek.getUTCDate() + 7);
                            nextTriggerTime = nextWeek.toISOString();
                        }
                    }
                }
                
                const { data, error } = await supabase
                    .from('schedules')
                    .insert([{
                        user_email: 'insparisk-admin', // Fixed user identifier
                        agent_type: formData.agentType,
                        schedule_time: utcTime,
                        timezone: userTimezone,
                        is_recurring: formData.isRecurring,
                        recurring_pattern: formData.recurringPattern,
                        webhook_url: formData.webhookUrl,
                        selected_days: formData.selectedDays.length > 0 ? formData.selectedDays : null,
                        next_trigger_time: nextTriggerTime,
                        status: 'pending'
                    }])
                    .select();

                if (error) throw error;

                showSuccess('Schedule created successfully!');
                loadExistingSchedules();
                resetForm();
                
            } catch (error) {
                console.error('Error creating schedule:', error);
                showError('Failed to create schedule. Please try again.');
            } finally {
                showLoading(false);
            }
        }

        async function loadExistingSchedules() {
            try {
                const { data, error } = await supabase
                    .from('schedules')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                displaySchedules(data || []);
            } catch (error) {
                console.error('Error loading schedules:', error);
            }
        }

        function displaySchedules(schedules) {
            const container = document.getElementById('schedulesList');
            
            if (schedules.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #64748b; padding: 40px;">No schedules found. Create your first schedule above!</p>';
                return;
            }

            container.innerHTML = schedules.map(schedule => {
                const scheduleDate = new Date(schedule.schedule_time);
                const nextTrigger = schedule.next_trigger_time ? new Date(schedule.next_trigger_time) : null;
                
                return `
                    <div class="schedule-item">
                        <div class="schedule-info">
                            <h4>${getAgentDisplayName(schedule.agent_type)}</h4>
                            <p><strong>User:</strong> ${schedule.user_email}</p>
                            <p><strong>Scheduled:</strong> ${scheduleDate.toLocaleString('en-US', { 
                                timeZone: schedule.timezone,
                                weekday: 'long',
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}</p>
                            ${schedule.is_recurring ? `<p><strong>Recurring:</strong> ${schedule.recurring_pattern}</p>` : ''}
                            ${schedule.selected_days && schedule.selected_days.length > 0 ? `<p><strong>Days:</strong> ${schedule.selected_days.join(', ')}</p>` : ''}
                            ${nextTrigger ? `<p><strong>Next Run:</strong> ${nextTrigger.toLocaleString('en-US', { 
                                timeZone: schedule.timezone,
                                weekday: 'long',
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}</p>` : ''}
                        </div>
                        <div class="schedule-actions">
                            <div class="schedule-status status-${schedule.status}">
                                ${schedule.status}
                            </div>
                            <button class="delete-btn" onclick="deleteSchedule('${schedule.id}')" title="Delete this schedule">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getAgentDisplayName(agentType) {
            const names = {
                'accounts_receivable': 'üí∞ Accounts Receivable',
                'boiler_quote': 'üî• Boiler Quote'
            };
            return names[agentType] || agentType;
        }

        function showLoading(show) {
            document.getElementById('loadingState').style.display = show ? 'block' : 'none';
            document.getElementById('scheduleBtn').disabled = show;
        }

        function showSuccess(message) {
            const successEl = document.getElementById('successMessage');
            successEl.textContent = message;
            successEl.style.display = 'block';
            setTimeout(() => {
                successEl.style.display = 'none';
            }, 5000);
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            setTimeout(() => {
                errorEl.style.display = 'none';
            }, 5000);
        }

        function resetForm() {
            document.getElementById('schedulingForm').reset();
            document.querySelectorAll('.agent-card').forEach(c => c.classList.remove('selected'));
            document.querySelectorAll('.recurring-option').forEach(o => o.classList.remove('selected'));
            document.querySelectorAll('.day-option').forEach(d => d.classList.remove('selected'));
            document.getElementById('daySelection').style.display = 'none';
            selectedAgent = null;
            selectedRecurring = 'none';
            selectedDays = [];
            initializeApp();
        }

        // Delete schedule function
        async function deleteSchedule(scheduleId) {
            if (!confirm('Are you sure you want to delete this schedule? This action cannot be undone.')) {
                return;
            }

            try {
                showLoading(true);
                
                const { error } = await supabase
                    .from('schedules')
                    .delete()
                    .eq('id', scheduleId);

                if (error) throw error;

                showSuccess('Schedule deleted successfully!');
                loadExistingSchedules();
                
            } catch (error) {
                console.error('Error deleting schedule:', error);
                showError('Failed to delete schedule. Please try again.');
            } finally {
                showLoading(false);
            }
        }
    </script>
</body>
</html>
